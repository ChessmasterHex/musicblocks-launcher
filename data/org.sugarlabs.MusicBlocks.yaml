app-id: org.sugarlabs.MusicBlocks
branch: stable
runtime: org.freedesktop.Platform
runtime-version: '19.08'
sdk: org.freedesktop.Sdk
separate-locales: false
command: musicblocks
finish-args:
  '--share=ipc'
  '--socket=x11'
  '--socket=pulseaudio'
  '--share=network'
  '--device=dri'
  '--filesystem=home'
  '--env=MUSICBLOCKS_PATH=/app/share/musicblocks'
modules:
  - name: mb-data
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST}
      - install -d /app/share/appdata
      - mv /app/share/metadata/org.sugarlabs.MusicBlocks.appdata.xml /app/share/appdata
    sources:
      - type: git
        path: '..'
        branch: 'HEAD'

  - name: musicblocks
    buildsystem: simple
    build-commands:
      - mv MusicBlocks.sh /app/bin/MusicBlocks
    sources:
      - type: file
        path: MusicBlocks-aarch64
        dest-filename: 'MusicBlocks.sh'
        only-arches:
          aarch64
      - type: file
        path: MusicBlocks-arm
        dest-filename: 'MusicBlocks.sh'
        only-arches:
          arm
      - type: file
        path: MusicBlocks-i386
        dest-filename: 'MusicBlocks.sh'
        only-arches:
          i386
      - type: file
        path: MusicBlocks-x86_64
        dest-filename: 'MusicBlocks.sh'
        only-arches:
          x86_64
      - type: script
        dest-filename: musicblocks
        commands:
          - /app/bin/MusicBlocks
